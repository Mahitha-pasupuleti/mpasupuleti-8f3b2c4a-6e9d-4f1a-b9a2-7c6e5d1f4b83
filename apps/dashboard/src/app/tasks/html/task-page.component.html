<div class="tasks-dashboard">

  <!-- Header -->
  <header class="dashboard-header">
    <h1>Task Management Dashboard</h1>
    <button class="btn logout-btn" (click)="logout()">Logout</button>
  </header>

  <!-- Add Task Form -->
  <section class="add-task-section">
    <form (ngSubmit)="addTask()" #taskForm="ngForm" class="add-task-form">
      <input type="text" name="title" [(ngModel)]="newTask.title" placeholder="Task Title" required />
      <input type="text" name="description" [(ngModel)]="newTask.description" placeholder="Description" />
      <select name="category" [(ngModel)]="newTask.category" required>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>
      <button type="submit" class="btn add-btn" [disabled]="!taskForm.form.valid">+ Add Task</button>
    </form>

    <div class="messages">
      <p *ngIf="success" class="success-msg">{{ success }}</p>
      <p *ngIf="error" class="error-msg">{{ error }}</p>
    </div>
  </section>

  <!-- Category Filter -->
  <div class="filter-section">
    <label for="categoryFilter">Filter by Category:</label>
    <select id="categoryFilter" [(ngModel)]="selectedCategory" (change)="onCategoryChange(selectedCategory)">
      <option value="">All</option>
      <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
    </select>
  </div>

  <!-- Task List -->
  <section class="tasks-list">
    <ul>
      <li *ngFor="let task of tasks" class="task-card">

        <div class="task-main">

          <!-- Left: Title + Description -->
          <div class="task-left">
            <div class="task-title">{{ task.title }}</div>
            <div class="task-desc">{{ task.description || 'No description' }}</div>
          </div>

          <!-- Middle: Meta info -->
          <div class="task-meta">
            <span class="meta-item">Owner: {{ task.owner?.name || 'N/A' }}</span>
            <span class="meta-item">Org: {{ task.orgId || 'N/A' }}</span>
            <span class="meta-item category">{{ task.category || 'N/A' }}</span>
          </div>

          <!-- Right: Status + Actions -->
          <div class="task-right">
            <select class="status-select" [(ngModel)]="task.status" (change)="updateTaskStatus(task)">
              <option value="todo">Todo</option>
              <option value="in-progress">In Progress</option>
              <option value="done">Done</option>
            </select>
            <div class="task-actions">
              <button class="icon-btn edit-btn" (click)="startEdit(task)">✏️</button>
              <button class="icon-btn delete-btn" (click)="removeTask(task.id)">❌</button>
            </div>
          </div>

        </div>

        <!-- Inline Edit Form -->
        <div *ngIf="editingTask?.id === task.id" class="edit-form">
          <form (ngSubmit)="updateTask()" #editForm="ngForm">
            <input type="text" name="title" [(ngModel)]="editingTask.title" placeholder="Edit Title" required />
            <input type="text" name="description" [(ngModel)]="editingTask.description" placeholder="Edit Description" />
            <select name="category" [(ngModel)]="editingTask.category" required>
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
            <div class="edit-actions">
              <button type="submit" class="btn update-btn" [disabled]="!editForm.form.valid">Update</button>
              <button type="button" class="btn cancel-btn" (click)="cancelEdit()">Cancel</button>
            </div>
          </form>
        </div>

      </li>
    </ul>
  </section>
</div>
